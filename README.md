# System Design социальной сети для курса по System Design
https://balun.courses/courses/system_design

## Функциональные требования
- Пользователь может опубликовать пост, включающий фотографии, текстовое описание и геолокацию
- Пользователь может комментировать посты других пользователей
- Пользователь может ставить реакции постам других пользователей
- Пользователь может подписываться на других пользователей
- Пользователь может искать места для путешествий и просматривать посты с найденных мест
- Пользователь может просматривать ленту других пользователей

## Нефункциональные требования
- DAU - через год 10 000 000, в дальнейшем будет расти до 20 000 000.
- Регион использования: Только СНГ
- Сезонность: основные пики нагрузки будут приходиться на летний период, новогодние и майские праздники - 100 дней в году.
- Условия хранения данных: данные храним всегда.
- Лимиты и ограничения: 
  - кол-во фото в посте: от 0 до 10
  - размер текстового описания к посту: от 2 до 1000 символов
  - размер текста комментария: от 2 до 1000 символов
  - на кол-во постов в ленте ограничений нет
  - на кол-во подписчиков ограничений нет
  - вес одного фото не должен превышать 1 МЬ
- Ожидания:
  - один пользователь в среднем подписан на 5 других пользователей
  - один пост содержит в среднем 3 фото, описание на 300 символов и геолокацию
  - один пост содержит в среднем 5 комментариев по 50 символов и 10 реакций
  - вес фото в посте в среднем 1 Mb
- Доступность: 99.999%
- Тайминги:
  - добавление поста и комментария: не более 1 секунды
  - загрузка ленты: не более 2 секунд
  - поиск: не более 3 секунд
- Активность:
  - Публикация постов
    - 1 пользователь публикует 1 пост в неделю
	- Коэффициент сезонности: x21 (3 поста в день)
  - Добавление комментариев и реакций
    - 1 пользователь оставляет 2 комментария и реакции в день
    - Коэффициент сезонности: x3 (6 комментария и реакций в день)
  - Просмотр ленты
    - 1 пользователь просматривает ленту 1 раз за два дня
	- Коэффициент сезонности: x8 (4 раза в день)
    - Ожидается, что старые посты (которым больше года) в ленте будут просматриваться часто именно в несезон, т.к. пользователи будут искать места для отдыха.
  - Поиск
    - 1 пользователь может искать места для путешествий 1 раз в день
    - Коэффициент сезонности: x0.3 (раз в три дня)
  - Просмотр постов из ленты и поиска:
    - 1 пользователь может просматривать 3 поста за один поиск или просмотр ленты
    - Коэффициент сезонности: x3 (9 постов)
## Расчет нагрузки
### Throughput
- Публикация постов (с фото)
  - Throughput (write) = 20 000 000 * (1/7) / 86 400 = 33 RPS
  - Throughput (write) в сезонность: 33 * 21 = 700 RPS
- Добавление комментариев и реакций
  - Throughput (write) = 20 000 000 * 2 / 86 400 = 450 RPS
  - Throughput (write) в сезонность: 450 * 3 = 1350 RPS
- Просмотр ленты (с фото, без комментариев) - в среднем 1 пользователь за 1 просмотр ленты делает 3 постраничных запроса
  - Throughput (read) = (20 000 000 / 2 / 86 400) * 3 = 345 RPS
  - Throughput (read) в сезонность: 345 * 8 = 2760 RPS
- Поиск (с фото, без комментариев) - в среднем 1 пользователь за 1 просмотр ленты делает 3 постраничных запроса
  - Throughput (read) = (20 000 000 * 1 / 86 400) * 3 = 690 RPS
  - Throughput (read) в сезонность: (230 * 0.3) * 3 = 207 RPS
- Просмотр постов из ленты и поиска (с фото и комментариями):
  - Throughput (read) = (345 + 690) * 3 = 3105 RPS
  - Throughput (read) в сезонность: 3105 * 3 = 9315 RPS
### Traffic
- Фото в посте: 1 Mb * 3 = 3 Mb
- Метаданные поста (описание в посте и геолокация): 300 bytes + 8 bytes = 308 bytes
- Комментарии поста: 260 bytes
- Публикация постов (с фото)
  - В обычное время:
    - Traffic (write) = 33 * (3 Mb * 0.7) Mb = 70 Mb/s
    - Traffic (write) метаданные = 33 * 308 b = 10 Kb/s
  - В сезонность:
    - Traffic (write) = 70 * 21 = 1470 Mb/s
    - Traffic (write) метаданные = 10 * 21 = 210 Kb/s
- Добавление комментариев и реакций
  - В обычное время:
    - Traffic (write) = 450 * 50 bytes = 23 Kb/s
  - В сезонность:
    - Traffic (write) = 23 * 3 = 69 Kb/s
- Просмотр ленты (с фото, без комментариев)
  - При загрузке ленты отображаются первые 5 постов, остальные подгружаются уже после загрузки также по 5 постов за запрос
  - При передачи по сети фото передаются в сжатом виде и уменьшены в размере на 30%
  - Фото: 5 * (3 Mb * 0.7) = 10 Mb
  - Метаданные: 5 * 308 bytes = 1.5 Kb
  - В обычное время:
    - Traffic (read) фото = 345 * 10 Mb = 3450 Mb/s
    - Traffic (read) метаданные = 345 * 1.5 Kb = 518 Kb/s
  - В сезонность:
    - Traffic (read) фото = 3450 * 8 = 27600 Mb/s
    - Traffic (read) метаданные = 518 * 8 = 4144 Kb/s
- Поиск (с фото, без комментариев)
  - Если подгрузка по 5 постов за запрос:
  - В обычное время:
    - Traffic (read) фото = 690 * 10 Mb = 6900 Mb/s
    - Traffic (read) метаданные = 690 * 1.5 Kb = 1035 Kb/s
  - В сезонность:
    - Traffic (read) фото = 6900 Mb/s * 0.3 = 2070 Mb/s
    - Traffic (read) метаданные = 1035 Kb/s * 0.3 = 310 Kb/s
- Просмотр постов из ленты и поиска (с фото и комментариями):
  - В обычное время:
	- Traffic (read) фото = 3105 * 3 Mb = 9315 Mb/s
	- Traffic (read) комментарии = 3105 * 260 b = 807 Kb/s
    - Traffic (read) метаданные = 3105 * 308 b = 956 Kb/s
  - В сезонность:
	- Traffic (read) фото = 9315 Mb/s * 3 = 27945 Mb/s
	- Traffic (read) комментарии = 807 Kb/s * 3 = 2421 Kb/s
    - Traffic (read) метаданные = 956 Kb/s * 3 = 2868 Kb/s