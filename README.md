# System Design социальной сети для курса по System Design
https://balun.courses/courses/system_design

## Функциональные требования
- Пользователь может опубликовать пост, включающий фотографии, текстовое описание и геолокацию
- Пользователь может комментировать посты других пользователей
- Пользователь может ставить реакции постам других пользователей
- Пользователь может подписываться на других пользователей
- Пользователь может искать места для путешествий и просматривать посты с найденных мест
- Пользователь может просматривать ленту других пользователей

## Нефункциональные требования
- DAU - 10 000 000 за первый год, дальнейший рост x1.5 в год.
- Общее число пользователей за первый год - 100 000 000
- Регион использования: Только СНГ
- Сезонность: основные пики нагрузки будут приходиться на летний период, новогодние и майские праздники - 100 дней в году.
- Условия хранения данных: данные храним всегда.
- Лимиты и ограничения: 
  - кол-во фото в посте: от 0 до 10
  - размер текстового описания к посту: от 2 до 1000 символов
  - размер текста комментария: от 2 до 1000 символов
  - на кол-во постов в ленте ограничений нет
  - на кол-во подписчиков ограничений нет
  - вес одного фото не должен превышать 1 МЬ
- Ожидания:
  - один пользователь в среднем подписывается на 5 других пользователей за год
  - один пост содержит в среднем 3 фото, описание на 300 символов и геолокацию
  - один пост содержит в среднем 5 комментариев по 50 символов и 10 реакций
  - вес фото в посте в среднем 1 Mb
- Доступность: 99.999%
- Тайминги:
  - добавление поста и комментария: не более 1 секунды
  - загрузка ленты: не более 2 секунд
  - поиск: не более 3 секунд
- Активность:
  - Публикация постов
    - 1 пользователь публикует 1 пост в неделю
	- Коэффициент сезонности: x21 (3 поста в день)
    - 1 пользователь публикует в среднем 38 постов в год в несезон + 300 постов в год в сезон. Всего 338 постов в год.
  - Добавление комментариев и реакций
    - 1 пользователь оставляет 2 комментария и реакции в день
    - Коэффициент сезонности: x3 (6 комментария и реакций в день)
  - Просмотр ленты
    - 1 пользователь просматривает ленту 1 раз за два дня
	- Коэффициент сезонности: x8 (4 раза в день)
    - Ожидается, что старые посты (которым больше года) в ленте будут просматриваться часто именно в несезон, т.к. пользователи будут искать места для отдыха.
  - Поиск
    - 1 пользователь может искать места для путешествий 1 раз в день
    - Коэффициент сезонности: x0.3 (раз в три дня)
  - Просмотр постов из ленты и поиска:
    - 1 пользователь может просматривать 3 поста за один поиск или просмотр ленты
    - Коэффициент сезонности: x3 (9 постов)
## Расчет нагрузки
### Throughput
- Публикация постов (с фото)
  - Throughput (write) = 20 000 000 * (1/7) / 86 400 = 33 RPS
  - Throughput (write) в сезонность: 33 * 21 = 700 RPS
- Добавление комментариев и реакций
  - Throughput (write) = 20 000 000 * 2 / 86 400 = 450 RPS
  - Throughput (write) в сезонность: 450 * 3 = 1350 RPS
- Просмотр ленты (с фото, без комментариев) - в среднем 1 пользователь за 1 просмотр ленты делает 3 постраничных запроса
  - Throughput (read) = (20 000 000 / 2 / 86 400) * 3 = 345 RPS
  - Throughput (read) в сезонность: 345 * 8 = 2760 RPS
- Поиск (с фото, без комментариев) - в среднем 1 пользователь за 1 просмотр ленты делает 3 постраничных запроса
  - Throughput (read) = (20 000 000 * 1 / 86 400) * 3 = 690 RPS
  - Throughput (read) в сезонность: (230 * 0.3) * 3 = 207 RPS
- Просмотр постов из ленты и поиска (подгрузка только комментариев, фото и метаданные уже загружены):
  - Throughput (read) = (345 + 690) * 3 = 3105 RPS
  - Throughput (read) в сезонность: 3105 * 3 = 9315 RPS
### Traffic
- Фото в посте: 1 Mb * 3 = 3 Mb
- Метаданные поста (описание в посте и геолокация): 300 bytes + 8 bytes = 308 bytes
- Комментарии поста: 260 bytes
- Публикация постов (с фото)
  - В обычное время:
    - Traffic (write) фото = 33 * (3 Mb * 0.7) Mb = 70 Mb/s
    - Traffic (write) метаданные = 33 * 308 b = 10 Kb/s
  - В сезонность:
    - Traffic (write) фото = 70 * 21 = 1470 Mb/s
    - Traffic (write) метаданные = 10 * 21 = 210 Kb/s
- Добавление комментариев и реакций
  - В обычное время:
    - Traffic (write) = 450 * 50 bytes = 23 Kb/s
  - В сезонность:
    - Traffic (write) = 23 * 3 = 69 Kb/s
- Просмотр ленты (с фото, без комментариев)
  - При загрузке ленты отображаются первые 5 постов, остальные подгружаются уже после загрузки также по 5 постов за запрос
  - При передачи по сети фото передаются в сжатом виде и уменьшены в размере на 30%
  - Фото: 5 * (3 Mb * 0.7) = 10 Mb
  - Метаданные: 5 * 308 bytes = 1.5 Kb
  - В обычное время:
    - Traffic (read) фото = 345 * 10 Mb = 3450 Mb/s
    - Traffic (read) метаданные = 345 * 1.5 Kb = 518 Kb/s
  - В сезонность:
    - Traffic (read) фото = 3450 * 8 = 27600 Mb/s
    - Traffic (read) метаданные = 518 * 8 = 4144 Kb/s
- Поиск (с фото, без комментариев)
  - Если подгрузка по 5 постов за запрос:
  - В обычное время:
    - Traffic (read) фото = 690 * 10 Mb = 6900 Mb/s
    - Traffic (read) метаданные = 690 * 1.5 Kb = 1035 Kb/s
  - В сезонность:
    - Traffic (read) фото = 6900 Mb/s * 0.3 = 2070 Mb/s
    - Traffic (read) метаданные = 1035 Kb/s * 0.3 = 310 Kb/s
- Просмотр постов из ленты и поиска (подгрузка только комментариев, фото и метаданные уже загружены):
  - В обычное время:
	- Traffic (read) фото = 0
    - Traffic (read) метаданные = 0
	- Traffic (read) комментарии = 3105 * 260 b = 807 Kb/s
  - В сезонность:
	- Traffic (read) фото = 0
    - Traffic (read) метаданные = 0
	- Traffic (read) комментарии = 807 Kb/s * 3 = 2421 Kb/s

### Required memory:
Расчеты за первый год
- Медиа
  - В обычное время (HDD):
    Сapacity = 33 RPS * 3 Mb * 86 400 * 265 days = 2 300 Tb
	Disks_for_capacity = 2 300 ТБ / 32 ТБ = 72
	Disks_for_throughput = (70 Mb/s + 3450 Mb/s + 6900 Mb/s) / 100 МБ/с = 104
	Disks_for_iops = (33 RPS + 345 RPS + 690 RPS) / 100 = 11
	Disks = max(72, 104, 11) = 104 HDD диска по 32 Tb

  - В сезонность (HDD):
    Сapacity = 700 RPS * 3Mb * 86 400 * 100 days = 18 000 Tb
    Disks_for_capacity = 18 000 Tb / 32 Tb = 563
	Disks_for_throughput = (1470 Mb/s + 27600 Mb/s + 6900 Mb/s) / 100 МБ/с = 360
    Disks_for_iops = (700 RPS + 2760 RPS + 207 RPS) / 100 = 37
    Disks = max(563, 360, 37) = 563 HDD диска по 32 Tb

- Посты (метаданные)
  - В обычное время (SSD SATA):
    Сapacity = 33 RPS * 400 b * 86 400 * 265 days = 302 Gb
	Disks_for_capacity = 302 Gb / 1 ТБ = 1
	Disks_for_throughput = (10 Kb/s + 518 Kb/s + 1035 Kb/s) / 500 МБ/с = 1
	Disks_for_iops = (33 RPS + 345 RPS + 690 RPS) / 1000 = 2
	Disks = max(1, 1, 2) = 2 SSD (SATA) диска по 1 Tb

  - В сезонность (SSD SATA):
    Сapacity = 700 RPS * 400 b * 86 400 * 100 days = 3 Tb
    Disks_for_capacity = 3 Tb / 1 ТБ = 3
	Disks_for_throughput = (210 Kb/s + 4144 Kb/s + 310 Kb/s) / 500 МБ/с = 1
    Disks_for_iops = (700 RPS + 2760 RPS + 207 RPS) / 1000 = 4
    Disks = max(3, 1, 4) = 4 SSD (SATA) диска по 1 Tb

- Комментарии
  - В обычное время (SSD SATA):
    Сapacity = 450 RPS * 100 b * 86 400 * 265 days = 2 Tb
	Disks_for_capacity = 2 Gb / 1 ТБ = 2
	Disks_for_throughput = (23 Kb/s + 807 Kb/s) / 500 МБ/с = 1
	Disks_for_iops = (450 RPS + 3105 RPS) / 1000 = 4
	Disks = max(2, 1, 4) = 4 SSD (SATA) диска по 1 Tb

  - В сезонность (SSD SATA):
    Сapacity = 700 RPS * 100 b * 86 400 * 100 days = 604 Gb
    Disks_for_capacity = 604 Gb / 1 ТБ = 1
	Disks_for_throughput = (69 Kb/s + 2421 Kb/s) / 500 МБ/с = 1
    Disks_for_iops = (1350 RPS + 9315 RPS) / 1000 = 11
    Disks = max(1, 1, 11) = 11 SSD (SATA) дисков по 1 Tb

- Поиск
  - В обычное время (SSD SATA):
    Сapacity = 33 RPS * 700 b * 86 400 * 265 days = 528 Gb
	Disks_for_capacity = 528 Gb / 1 ТБ = 1
	Disks_for_throughput = (10 Kb/s + 1035 Kb/s) / 500 МБ/с = 1
	Disks_for_iops = (33 RPS + 690 RPS) / 1000 = 1
	Disks = max(1, 1, 1) = 1 SSD (SATA) диск по 1 Tb

  - В сезонность (SSD SATA):
    Сapacity = 700 RPS * 700 b * 86 400 * 100 days = 5 Tb
    Disks_for_capacity = 5 Tb / 1 ТБ = 5
	Disks_for_throughput = (210 Kb/s + 310 Kb/s) / 500 МБ/с = 1
    Disks_for_iops = (700 RPS + 207 RPS) / 1000 = 1
    Disks = max(5, 1, 1) = 5 SSD (SATA) дисков по 1 Tb

- Лента
  - В обычное время (SSD SATA):
    Сapacity = (100 000 000 * 500 b * 20) + (100 000 000 * 8 b * 338 * 5) = 1 Tb + 11 Tb = 12 Tb // 1 пользователь в среднем подписан на 5 других пользователей, у каждого из которых в среднем публикуется 338 постов в год. Отсюда 338 * 5
	Disks_for_capacity = 12 Tb / 8 ТБ = 2
	Disks_for_throughput = (10 Kb/s + 518 Kb/s) / 500 МБ/с = 1
	Disks_for_iops = (33 RPS + 345 RPS) / 1000 = 1
	Disks = max(2, 1, 1) = 1 SSD (SATA) диск по 8 Tb

  - В сезонность (SSD SATA):
    Сapacity = (100 000 000 * 500 b * 20) + (100 000 000 * 8 b * 338 * 5) = 1 Tb + 11 Tb = 12 Tb
	Disks_for_capacity = 12 Tb / 8 ТБ = 2
	Disks_for_throughput = (210 Kb/s + 4144 Kb/s) / 500 МБ/с = 1
    Disks_for_iops = (700 RPS + 2760 RPS) / 1000 = 4
    Disks = max(2, 1, 4) = 4 SSD (SATA) диска по 8 Tb

- Подписки
  - В обычное время (SSD SATA):
    Сapacity = 100 000 000 users * 5 subscribers * 2 lists * 8 b = 8 Gb
	Disks_for_capacity = 8 Gb / 1 ТБ = 1
	Disks_for_throughput = 1 Kb/s / 500 МБ/с = 1
	Disks_for_iops = 1 / 1000 = 1
	Disks = max(1, 1, 1) = 1 SSD (SATA) диск по 1 Tb

  - В сезонность (SSD SATA):
    Сapacity = 100 000 000 users * 5 subscribers * 2 lists * 8 b = 8 Gb
	Disks_for_capacity = 8 Gb / 1 ТБ = 1
	Disks_for_throughput = 1 Kb/s / 500 МБ/с = 1
	Disks_for_iops = 1 / 1000 = 1
	Disks = max(1, 1, 1) = 1 SSD (SATA) диск по 1 Tb